if (self.CavalryLogger) { CavalryLogger.start_js(["0zmve"]); }

__d("Popover",["CSS","DOM","MAria","MViewport","Stratcom","Vector","$","eventsMixinDeprecated","nullthrows","setTimeoutAcrossTransitions"],(function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){__p&&__p();var q=40;function r(a){"use strict";__p&&__p();var b=a.flyout;b=typeof b==="string"?m(b):b;this.flyout=b;this.content=h.scry(this.flyout,"div","flyout-content")[0];this.options=a;this._onOrientationChange=this._reposition.bind(this);g.conditionClass(this.flyout,"popover_flyout",!0);b=a.button;b&&(b=typeof b==="string"?m(b):b,this.buttonClickListener=h.listen(b,"click",null,this._openHandler.bind(this)),b.setAttribute("role","button"),i.setupPopup(b,this.flyout),this.button=b);b=a.flyoutAnchor;b?this.flyoutAnchor=typeof b==="string"?m(b):b:this.flyoutAnchor=this.button;this.options.flyoutFromRoot&&(this.flyoutClickListener=h.listen(this.flyout,"click",null,this._openHandler.bind(this)));this.options.touchstart_callback&&(this.flyoutTouchStartListener=h.listen(this.flyout,"touchstart",null,this._touchStartHandler.bind(this)));this.options.touchmove_callback&&(this.flyoutTouchMoveListener=h.listen(this.flyout,"touchmove",null,this._touchMoveHandler.bind(this)));this.options.touchend_callback&&(this.flyoutTouchEndListener=h.listen(this.flyout,"touchend",null,this._touchEndHandler.bind(this)));r._instances[this.flyout.id]=this}r.prototype.isOpen=function(){"use strict";return!!this._isOpen};r.prototype.open=function(){"use strict";__p&&__p();if(this.isOpen())return;r._activePopover&&r._activePopover.close();r._activePopover=this;this._isOpen=!0;this.constraint=null;g.conditionClass(this.flyout,"popover_hidden",!1);this.options.flyoutFromRoot&&this._absolutePositionFlyout();this._position();this.options.heightConstraint||(g.conditionClass(o(document.body),"disableClicks",!0),this.globalListener=k.listenCapture("click",null,this._closeHandler.bind(this)));window.addEventListener("orientationchange",this._onOrientationChange,!1);i.showPopup(this.button,this.flyout);if(this.options.ensureVisible){var a=j.getScrollTop(),b=this._getElementPosition(this.flyout).y,c=b+this.flyout.offsetHeight;c=c-(a+j.getUseableHeight());if(c>0){c=Math.min(c,Math.max(b-a-q,0));j.scrollTo(0,a+c)}}this.invoke("open")};r.prototype.close=function(a){"use strict";__p&&__p();if(!this.isOpen())return;r._activePopover=null;this._isOpen=!1;g.conditionClass(this.flyout,"popover_hidden",!0);this.options.flyoutFromRoot&&this.flyoutParent&&(this.flyoutParent.appendChild(this.flyout),delete this.flyoutParent);p(function(){g.conditionClass(o(document.body),"disableClicks",!1)}.bind(this),400);this.globalListener&&this.globalListener.remove();window.removeEventListener("orientationchange",this._onOrientationChange,!1);this._releaseConstraint();i.hidePopup(this.button,this.flyout);a||this.invoke("close")};r.prototype.clear=function(){"use strict";this.globalListener&&this.globalListener.remove(),this.buttonClickListener&&this.buttonClickListener.remove(),this.flyoutClickListener&&this.flyoutClickListener.remove(),this.flyoutTouchStartListener&&this.flyoutTouchStartListener.remove(),this.flyoutTouchMoveListener&&this.flyoutTouchMoveListener.remove(),this.flyoutTouchEndListener&&this.flyoutTouchEndListener.remove(),delete r._instances[this.flyout.id]};r.prototype.refreshConstraints=function(){"use strict";if(!this._isOpen)return!1;var a=this.flyout;this._releaseConstraint();this.options.heightConstraint?(a.style.minHeight=j.getUseableHeight()+"px",this.constraint=j.addHeightConstraint(l.getDim(this.content).y+this._getElementPosition(a).y)):this.constraint=j.addMinHeightConstraint(l.getDim(a).y+this._getElementPosition(a).y+r._MARGIN)};r.prototype._getTouchPoint=function(event){"use strict";var a,b=event.getRawEvent();b instanceof TouchEvent&&(a=b.targetTouches[0]);b={x:a?a.screenX:0,y:a?a.screenY:0};return b};r.prototype._touchStartHandler=function(event){"use strict";var a=this.options.touchstart_callback;a&&a(this._getTouchPoint(event))};r.prototype._touchMoveHandler=function(event){"use strict";if(this.isOpen()){var a=this.options.touchmove_callback;a&&a(this._getTouchPoint(event))}};r.prototype._touchEndHandler=function(event){"use strict";var a=this.options.touchend_callback;a&&a(this._getTouchPoint(event))};r.prototype._openHandler=function(event){"use strict";__p&&__p();event.prevent();var a=this.isOpen();if(a&&!this.options.preventClose)this.close();else if(!a){a=h.scry(document,"input");for(var b=0;b<a.length;b++)a[b].blur();this.open()}};r.prototype._closeHandler=function(event){"use strict";event.getNode("popover")||this.close()};r.prototype._getElementPosition=function(a){"use strict";__p&&__p();a=a;var b=a.offsetLeft,c=a.offsetTop;a=a.offsetParent;while(a&&a!==document.documentElement){b+=a.offsetLeft;c+=a.offsetTop;var d=window.getComputedStyle(a);b+=parseInt(d.getPropertyValue("border-left-width").slice(0,-2),10);c+=parseInt(d.getPropertyValue("border-top-width").slice(0,-2),10);a=a.offsetParent}return new l(b,c)};r.prototype._absolutePositionFlyout=function(){"use strict";this.flyoutParent=this.flyout.parentNode;m("root").appendChild(this.flyout);var a=this._getElementPosition(this.flyout.parentNode),b=this._getElementPosition(this.flyoutAnchor),c=l.getDim(this.flyoutAnchor);b=b.y-a.y+c.y;this.flyout.style.position="absolute";this.flyout.style.top=b+"px"};r.prototype._position=function(){"use strict";var a=this.flyout;if(this.flyoutAnchor&&this.options.positionNub){var b=this._getElementPosition(this.flyoutAnchor),c=h.find(this.flyout,"*","nub"),d=l.getDim(c).x,e=l.getDim(this.flyoutAnchor).x;a=this._getElementPosition(a);new l(b.x-a.x+(e-d)/2,0).setPos(c)}this.refreshConstraints()};r.prototype._reposition=function(){"use strict";p(this._position.bind(this),0)};r.prototype._releaseConstraint=function(){"use strict";this.constraint&&(this.constraint.release(),this.constraint=null)};r.getInstance=function(a){"use strict";return r._instances[a]};r.clearAll=function(){"use strict";for(var a=0;a<r._instances.length;a++)r._instances[a].clear()};r._activePopover=null;r._MARGIN=40;r._instances={};n(r,["open","close"]);e.exports=r}),null);
__d("MJewel",["CSS","DOM","MHistory","MJSEnvironment","MLogState","MTabbable","MViewport","Popover","Stratcom","URI","$","eventsMixinDeprecated","intlNumUtils","setTimeoutAcrossTransitions"],(function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){__p&&__p();var u="acw",v="aclb",w=3e3,x=0;function y(a,b){"use strict";this._count=0,this._sigil=a,this.options=b||{},this._jewelNode=q(y.JEWEL_NAV_NODE_ID),this._softState=b.softState||"jewel="+x++,this._contentsSigil=b.contentsSigil||"contents",this._pos=b.pos,this._additionalPaths=b.additionalPaths||[],this._noPopover=!!b.noPopover,this._createPopover(),o.listen("m:history:change",null,this._updateJewelsOnHistoryChange.bind(this))}y.prototype._updateJewelsOnHistoryChange=function(event){"use strict";event.getData().soft===this._softState?this._popover&&this._popover.open():this._popover&&this._popover.close(),this._updateIsJewelActive(event)};y.prototype.isInitialized=function(){"use strict";return!!h.scry(this._jewelNode,"*",this._contentsSigil)[0]};y.prototype._getJewelElement=function(){"use strict";return h.find(this._jewelNode,"div",this._sigil)};y.prototype._getCountElement=function(){"use strict";return h.find(this._getJewelElement(),"span","count")};y.prototype._getContentsElement=function(){"use strict";return h.find(this._getJewelElement(),"*",this._contentsSigil)};y.prototype._getFlyoutElement=function(){"use strict";return h.find(this._getJewelElement(),"*","flyout")};y.prototype.getCount=function(){"use strict";return this._count};y.prototype._updateCountElement=function(){"use strict";var a=this._getJewelCount();h.setContent(this._getCountElement(),s.formatNumberWithThousandDelimiters(a));a=this._getJewelElement();var b=this._count>0;g.conditionClass(a,"noCount",!b);g.conditionClass(a,"hasCount",b)};y.prototype._updateIsJewelActive=function(event){"use strict";var a=new p(event.getData().path);a=a.getPath();var b=event.getData().soft;a=!b&&this._additionalPaths.includes(a);b=b===this._softState;g.conditionClass(this._getJewelElement(),"popoverOpen",b||a)};y.prototype.setCount=function(a){"use strict";if(a<0)return;this._count=a;this._updateCountElement()};y.prototype.updateCount=function(a,b){"use strict";!this.isOpen()?this.setCount(a):a&&b()};y.prototype.setHeaderText=function(a,b){"use strict";__p&&__p();if(!a||!b)return;var c=this._getFlyoutElement();if(!c)return;c=h.scry(c,"*",a)[0];if(!c)return;a=c.cloneNode(!0);a.innerText=b;h.replace(c,a)};y.prototype.handleViewedContent=function(){"use strict";this.getCount()>0&&this.isInitialized()?(this.setCount(0),this.invoke("cleared")):this.invoke("jewel_click")};y.prototype.removeMenuContent=function(a){"use strict";a=document.getElementById(a);a&&h.remove(a)};y.prototype.updateMenuColor=function(a,b,c){"use strict";c?t(this._updateMenuColor.bind(this,a,b),w):this._updateMenuColor(a,b)};y.prototype._updateMenuColor=function(a,b){"use strict";a=document.getElementById(a);a&&(g.conditionClass(a,v,!b),g.conditionClass(a,u,b))};y.prototype._createPopover=function(){"use strict";if(this._noPopover)return;var a=this._getJewelElement(),b=h.find(a,"div","flyout");this._popover=new n({button:h.find(a,"*","icon"),flyout:b,ensureVisible:!1,heightConstraint:!0,preventClose:!0});this._onOpenListener=this._popover.listen("open",this._onOpen.bind(this));this._onCloseListener=this._popover.listen("close",this._onClose.bind(this));this._popoverClickListener=h.listen(b,"click",null,this._onPopoverClick.bind(this));j.IS_ANDROID&&j.GET_OS_VERSION>=4&&(this._scrollAreaNode=h.scry(b,"div","scroll-area")[0])};y.prototype.clear=function(){"use strict";this._onOpenListener&&this._onOpenListener.remove(),this._onCloseListener&&this._onCloseListener.remove(),this._popoverClickListener&&this._popoverClickListener.remove(),this._popover&&this._popover.clear()};y.prototype._onPopoverClick=function(event){"use strict";k.updateLink(event,this._pos)};y.prototype._onPopoverTouchStart=function(event){"use strict";event.kill()};y.prototype._getJewelCount=function(){"use strict";if(this._count>0)return this._count;else return 0};y.prototype._onOpen=function(){"use strict";__p&&__p();if(this._scrollAreaNode){m.scrollToHeader();var a=document.documentElement;a&&(g.conditionClass(a,"hide-scroll",!0),this._scrollAreaNode.style.maxHeight=a.offsetHeight-200+"px")}i.pushSoftState(this._softState);this.handleViewedContent();o.invoke("m:jewel:flyout:open",null,{jewel:this._sigil});a=h.find(this._getJewelElement(),"div","flyout");l.focusTabbable(a)};y.prototype._onClose=function(){"use strict";if(this._scrollAreaNode){this._scrollAreaNode.style.minHeight="";var a=document.documentElement;a&&g.conditionClass(a,"hide-scroll",!1)}o.invoke("m:jewel:flyout:close",null,{jewel:this._sigil});i.popSoftState(this._softState)};y.prototype.isOpen=function(){"use strict";return this._popover&&this._popover.isOpen()};y.prototype.reregisterListeners=function(){"use strict";var a=this.isOpen();this.clear();this._createPopover();a&&this._popover.open()};y.JEWEL_NAV_NODE_ID="mJewelNav";r(y,["cleared","jewel_click"]);e.exports=y}),null);
__d("MJewels",[],(function(a,b,c,d,e,f){e.exports={REQUESTS:"requests",MESSAGES:"messages",NOTIFICATIONS:"notifications",SEARCH:"search",MORE:"more",NEWS_FEED:"news-feed",BOOKMARKS:"bookmarks",VIDEOS:"videos",CASUAL_GROUPS:"casual_groups",MARKETPLACE:"marketplace"}}),null);
__d("FriendingSurfaceVisitationTypedLogger",["Banzai","GeneratedLoggerUtils","nullthrows"],(function(a,b,c,d,e,f,g,h,i){"use strict";__p&&__p();function a(){this.clear()}a.prototype.log=function(){h.log("logger:FriendingSurfaceVisitationLoggerConfig",this.$1,g.BASIC)};a.prototype.logVital=function(){h.log("logger:FriendingSurfaceVisitationLoggerConfig",this.$1,g.VITAL)};a.prototype.logImmediately=function(){h.log("logger:FriendingSurfaceVisitationLoggerConfig",this.$1,{signal:!0})};a.prototype.clear=function(){this.$1={};return this};a.prototype.getData=function(){return babelHelpers["extends"]({},this.$1)};a.prototype.updateData=function(a){this.$1=babelHelpers["extends"]({},this.$1,a);return this};a.prototype.setAppVersion=function(a){this.$1.app_version=a;return this};a.prototype.setBadgeCount=function(a){this.$1.badge_count=a;return this};a.prototype.setClientTimestamp=function(a){this.$1.client_timestamp=a;return this};a.prototype.setRawRefTab=function(a){this.$1.raw_ref_tab=a;return this};a.prototype.setRawTab=function(a){this.$1.raw_tab=a;return this};a.prototype.setRefPage=function(a){this.$1.ref_page=a;return this};a.prototype.setSurface=function(a){this.$1.surface=a;return this};a.prototype.setTargetProfileID=function(a){this.$1.target_profile_id=a;return this};a.prototype.setVC=function(a){this.$1.vc=a;return this};b={app_version:!0,badge_count:!0,client_timestamp:!0,raw_ref_tab:!0,raw_tab:!0,ref_page:!0,surface:!0,target_profile_id:!0,vc:!0};e.exports=a}),null);
__d("XFriendRequestIHEventLoggingController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/requests/interaction_history_logging/",{target_id:{type:"FBID",required:!0},log_event:{type:"String",required:!0}})}),null);
__d("MFriendRequestIHEventLogger",["DOM","FBJSON","MRequest","XFriendRequestIHEventLoggingController"],(function(a,b,c,d,e,f,g,h,i,j){__p&&__p();a={listenToProfileClick:function(a,b,c){a=h.parse(a.getAttribute("data-store"));var d=a.userid?a.userid.toString():null;g.listen(c,"click",null,function(){this.logClick(d)}.bind(this));g.listen(b,"click",null,function(){this.logClick(d)}.bind(this))},logImpression:function(a){a&&this._logEvent(a,"impression")},logClick:function(a){a&&this._logEvent(a,"click")},_logEvent:function(a,event){if(isNaN(a))return;a=j.getURIBuilder().setFBID("target_id",a).setString("log_event",event).getURI();new i(a).send()}};e.exports=a}),null);
__d("XExpireFriendRequestsMutationController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/ajax/requests/expire/",{from_m_jewel:{type:"Bool",defaultValue:!1}})}),null);
__d("MFriendingJewel",["Arbiter","DOM","FriendingSurfaceVisitationTypedLogger","MarauderLogger","MFriendRequestIHEventLogger","MJewel","MJewels","MLegacyDataStore","MLogState","MPymkFunnelLogger","MRequest","MURI","Popover","Stratcom","XExpireFriendRequestsMutationController","invariant"],(function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){"use strict";__p&&__p();var w="/friends/center/requests/",x,y=!1,z=!1;function A(){__p&&__p();x||v(0);g.subscribe("m:jewels:init-counts",B,"all");x.listen("cleared",G);x.listen("jewel_click",D);if(z)return;z=!0;t.listen("jewel_requests_add",null,I);t.listen("jewel_requests_remove_old",null,I);t.listen("friend_requests_expired",null,J);t.listen("jewel_friending_notifs",null,I);t.listen("mobile_requests_count",null,I);t.listen("friend_requests_seen",null,K);t.listen("m:requests:refresh",null,L);t.listen("m:jewel:flyout:open",null,C)}function B(event,a){a=a.request_count;if(!x||!a)return;x.reregisterListeners();x.updateCount(a,G)}function C(event){var a=event.getData();if(a.jewel!=="requests")return;new q(u.getURIBuilder().setBool("from_m_jewel",!0).getURI()).send()}function D(){x||v(0),E(),new i().setSurface("jewel").setBadgeCount(x.getCount()).log(),M.lazyLoadRequestsJewelIfTabOpen()}function E(){__p&&__p();x||v(0);var a=x._getContentsElement();if(!a)return;a=h.scry(a,"div","attachment");var b=[];for(var c=0;c<a.length;c++){var d=a[c].getAttribute("id");d&&d.startsWith("m_jewel_req_")&&(b=b.concat(d.replace("m_jewel_req_","")))}if(b.length){d=new q("/friends/requests/log_impressions");d.setMethod("POST");d.addData({ids:b.join(","),ref:"m_jewel"});d.send()}}function F(){__p&&__p();if(y)return;x||v(0);y=!0;var a=x._getContentsElement();a=h.scry(a,"div","undoable-action");for(var b=0;b<a.length;b++){var c=a[b].getAttribute("data-pymk-id");if(c){var d=a[b].getAttribute("data-signature");p.logImpression(c,d,"mobile_jewel")}else{c=n.get(a[b]).userid;j.log("request_seen","friend_request_waterfall",{request_id:c,request_location:"requests_jewel"});k.logImpression(c?c.toString():null)}}}function G(){t.invoke("m_requests_jewel_mark_read");var a=new q(new r("/a/jewel_requests_read.php").toString());a.send()}function H(){new q("/ajax/mobile/friends/jewel/requests_markup").send()}function I(){if(!x)return;if(x.isOpen())return;H()}function J(){if(!x)return;H()}function K(event){if(!x)return;x.setCount(0)}function L(){var a=s.getInstance("reqs_flyout");a&&a.refreshConstraints()}var M={initJewel:function(a){x=new l("requests",{pos:o.CLICK_POSITION_REQUESTS_FLYOUT,softState:m.REQUESTS,noPopover:a.shouldRedirectRequestsJewel,additionalPaths:[w]}),A()},lazyLoadRequestsJewelIfTabOpen:function(){if(x&&x.isOpen()){var a=x._getContentsElement();if(t.hasSigil(a,"requests-flyout-pagelet-placeholder"))return;t.hasSigil(a,"requests-flyout-loading")?H():F()}},onAfterUpdateFriendRequests:function(a){if(!x)return;!x.isOpen()?x.setCount(a):a&&G();L();x.isOpen()&&F()},onAfterLoadMoreFriendSuggestions:function(){if(!x)return;L()}};e.exports=M}),null);
__d("MMessagesThreadRowID",[],(function(a,b,c,d,e,f){"use strict";var g="other_user_fbid_",h="thread_fbid_";function a(a,b,c){return a+(b?g+b:h+String(c))}e.exports={getThreadRowID:a}}),null);
__d("MessagingEvent",[],(function(a,b,c,d,e,f){e.exports=Object.freeze({DELETE:"delete",DELETE_MESSAGES:"delete_messages",DELIVER:"deliver",ERROR:"error",READ:"read",REPORT_SPAM:"report_spam",REPORT_SPAM_MESSAGES:"report_spam_messages",UNMARK_SPAM:"unmark_spam",SUBSCRIBE:"subscribe",CHANGE_MUTE_SETTINGS:"change_mute_settings",TAG:"tag",UNREAD:"unread",UNSUBSCRIBE:"unsubscribe",DELIVER_LOG:"deliver_log",MARK_ALL_READ:"mark_all_read",MARK_ALL_SEEN:"mark_all_seen",MORE_THREADS:"more_threads",READ_ALL:"read_all",READ_RECEIPT:"read_receipt",DELIVERY_RECEIPT:"delivery_receipt",SENT_PUSH:"sent_push",DELIVER_FAST_PAST:"deliver_fast_path",MESSENGER_STATUS:"messenger_status",UPDATE_PINNED_THREADS:"update_pinned_threads",CHANGE_PAGE_THREAD_FLAG:"change_page_thread_flag",CREATE_PAGE_ADMIN_NOTE:"create_page_admin_note",NO_OP:"no_op"})}),null);
__d("XFBConfirmationCliffTypedLogger",["Banzai","GeneratedLoggerUtils","nullthrows"],(function(a,b,c,d,e,f,g,h,i){"use strict";__p&&__p();function a(){this.clear()}a.prototype.log=function(){h.log("logger:XFBConfirmationCliffLoggerConfig",this.$1,g.BASIC)};a.prototype.logVital=function(){h.log("logger:XFBConfirmationCliffLoggerConfig",this.$1,g.VITAL)};a.prototype.logImmediately=function(){h.log("logger:XFBConfirmationCliffLoggerConfig",this.$1,{signal:!0})};a.prototype.clear=function(){this.$1={};return this};a.prototype.getData=function(){return babelHelpers["extends"]({},this.$1)};a.prototype.updateData=function(a){this.$1=babelHelpers["extends"]({},this.$1,a);return this};a.prototype.setCliffCaller=function(a){this.$1.cliff_caller=a;return this};a.prototype.setError=function(a){this.$1.error=a;return this};a.prototype.setSurface=function(a){this.$1.surface=a;return this};a.prototype.updateExtraData=function(a){a=i(h.serializeMap(a));h.checkExtraDataFieldNames(a,j);this.$1=babelHelpers["extends"]({},this.$1,a);return this};a.prototype.addToExtraData=function(a,b){var c={};c[a]=b;return this.updateExtraData(c)};var j={cliff_caller:!0,error:!0,surface:!0};e.exports=a}),null);
__d("XMessagesJewelContentController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/mobile/messages/jewel/content/",{spinner_id:{type:"String",required:!0}})}),null);
__d("MMessagesJewel",["Arbiter","ChannelEventType","DOM","MessagingEvent","MJewel","MJewels","MLogState","MMessagesThreadRowID","MRequest","MURI","Popover","Stratcom","XFBConfirmationCliffTypedLogger","XMessagesJewelContentController","fbt","invariant"],(function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){"use strict";__p&&__p();var w="mJewelMsgThreadContents",x="msg_",y,z,A=!1;function B(){y||v(0),g.subscribe("m:jewels:init-counts",C,"all"),y.listen("cleared",E),A||(A=!0,r.listen(h.MESSAGE,null,I),r.listen(h.MESSAGE,null,F),r.listen("m:jewel:flyout:open",null,D))}function C(event,a){__p&&__p();var b=a.viewer_id,c=a.unseen_thread_ids;a=a.unread_thread_ids;b&&(K.viewerID=b);c&&(K.unseenThreadIDs=c.reduce(function(a,b){a[b]=1;return a},{}));a&&(K.unreadThreadIDs=a.reduce(function(a,b){a[b]=1;return a},{}));c&&y&&(y.reregisterListeners(),y.updateCount(c.length,E))}function D(event){var a=event.getData();if(!y||a.jewel!=="messages")return;K.messengerCliff&&new s().setSurface("messenger_seen").log();a=y.getCount();y.setCount(a);H()}function E(){var a=new o(new p("/a/jewel_messages_read.php").toString());a.send()}function F(event){__p&&__p();var a=event.getData();if(!a||!y)return;if(a.event===j.READ&&a.message.folder==="inbox"){var b=a.message.thread_fbid||a.message.other_user_fbid;delete K.unseenThreadIDs[b];delete K.unreadThreadIDs[b]}else if(a.event===j.UNREAD&&a.message.folder==="inbox"){b=a.message.thread_fbid||a.message.other_user_fbid;K.unreadThreadIDs[b]=1}else if(a.event===j.MARK_ALL_READ&&a.message.folder==="inbox")K.unreadThreadIDs={},K.unseenThreadIDs={};else if(a.event===j.MARK_ALL_SEEN&&a.message.folder==="inbox")K.unseenThreadIDs={};else if(a.parsedPayload&&a.folder==="inbox"){b=a.parsedPayload;if(!G(K.viewerID,b)||b.isUnread()===!1||a.message.is_muted)return;a=b.getThreadFBID()||b.getOtherUserFBID();K.unseenThreadIDs[a]=1;K.unreadThreadIDs[a]=1}else return;b=Object.keys(K.unseenThreadIDs).length;a=Object.keys(K.unreadThreadIDs).length;!y.isOpen()&&b!==y.getCount()&&y.setCount(b);b=a>0?u._("Messages ({unread_message_count})",[u._param("unread_message_count",a)]):u._("Messages");y.setHeaderText("messages_jewel_header_text",b.toString())}function G(a,b){if(!b.getParticipantIDs())return!1;if(b.getParticipantIDs().indexOf(a)>-1)return!0;if(a)return b.getParticipantIDs().indexOf(a.toString())>-1;else return!1}function H(){y||v(0);var a=y._getJewelElement(),b="messages-flyout-loading";a=i.scry(a,"*",b);if(a.length>0){b=t.getURIBuilder().setString("spinner_id",a[0].getAttribute("id")).getURI();z||(z=new o(b),z.listen("finally",function(){z=null}),z.send())}}function I(event){__p&&__p();var a=event.getData();if(!a||!y)return;if(a.parsedPayload){var b=a.parsedPayload;if(!b.getFolder||b.getFolder()!=="inbox"||!G(K.viewerID,b))return;y.isInitialized()&&(y.removeMenuContent(J(b.getOtherUserFBID(),b.getThreadFBID())),y.isOpen()&&E());H()}else a.event===j.READ&&a.is_sync&&y.updateMenuColor(J(a.message.other_user_fbid,a.message.thread_fbid),!0,!1)}function J(a,b){return n.getThreadRowID(x,a,b)}var K={unseenThreadIDs:{},unreadThreadIDs:{},viewerID:null,messengerCliff:!1,initJewel:function(){y=new k("messages",{contentsSigil:w,pos:m.CLICK_POSITION_MESSAGES_FLYOUT,softState:l.MESSAGES}),B()},setMessengerCliff:function(a,b,c){K.messengerCliff=a},refreshMessagesConstraints:function(){q.getInstance("messages_flyout").refreshConstraints()}};e.exports=K}),null);
__d("MJewelThreads",["Bootloader","ChannelEventType","MessagingEvent","Stratcom"],(function(a,b,c,d,e,f,g,h,i,j){"use strict";__p&&__p();function a(a){this.$1=a,this.$2=[],this.$3=!1,this.$4=!1,j.listen(h.MESSAGE,null,this.onMessageEvent.bind(this))}a.prototype.getThreads=function(){return this.$2};a.prototype.registerListeners=function(){j.listen("click","live-threads",this.onThreadClick.bind(this)),j.listen("m:jewel:flyout:open",null,this.onJewelOpen.bind(this))};a.prototype.onJewelOpen=function(event){var a=event.getData();a=a&&a.jewel&&a.jewel==="messages";a&&this.$4&&this.updateUI()};a.prototype.onThreadClick=function(event){var a=event.getNode("live-thread");if(!a)return;this.setThreadReadStatus(a.getAttribute("data-fbid"),a.getAttribute("data-canonical")==="true",!0);this.updateUI()};a.prototype.onMessageEvent=function(event){__p&&__p();var a=event.getData();if(a.parsedPayload){var b=a.parsedPayload;if(b.getFolder()!=="inbox")return;this.$3||(this.$3=!0,this.registerListeners());this.addThread(b)}else if(Object.prototype.hasOwnProperty.call(a,"mark_as_read"))a.other_user_fbids.forEach(function(b){this.setThreadReadStatus(b.toString(),!0,a.mark_as_read)}.bind(this)),a.thread_fbids.forEach(function(b){this.setThreadReadStatus(b.toString(),!1,a.mark_as_read)}.bind(this)),this.updateUI();else if(a.event===i.READ&&a.is_sync){b=!!a.message.other_user_fbid;var c=b?a.message.other_user_fbid:a.message.thread_fbid;this.setThreadReadStatus(c,b,!0);this.updateUI()}};a.prototype.addThread=function(a){this.$2=this.$2.filter(function(b){b=b.isCanonicalThread()?b.getOtherUserFBID():b.getThreadFBID();return!this.isSameThread(b,a.isCanonicalThread(),a)}.bind(this)),a.unread=a.isUnread(),this.$2.push(a),this.$4=!0,this.updateThreadImage(a)};a.prototype.updateThreadImage=function(a){g.loadModules(["MMessagesThreadMetadataCache","MShortProfiles"],function(b,c){if(a.hasThreadImage())b.get(a.getThreadFBID(),function(b){a.image_src=b.image_src,this.updateUI()}.bind(this));else{b=a.isCanonicalThread()?a.getOtherUserFBID():a.getAuthorFBID();c.get(b,function(b){a.image_src=b.mThumbSrcSmall,this.updateUI()}.bind(this))}}.bind(this),"MJewelThreads")};a.prototype.setThreadReadStatus=function(a,b,c){this.$2.forEach(function(d){this.isSameThread(a,b,d)&&(d.unread==c&&(this.$4=!0),d.unread=!c)}.bind(this))};a.prototype.isSameThread=function(a,b,c){b=b?c.getOtherUserFBID():c.getThreadFBID();return a==b};a.prototype.updateUI=function(){if(!this.$3||!this.$4)return;g.loadModules(["React","ReactDOM","MJewelThreadList.react","Popover"],function(a,b,c,d){if(!d.getInstance("messages_flyout").isOpen())return;var e={threads:this.$2};b.render(a.createElement(c,e),this.$1);d.getInstance("messages_flyout").refreshConstraints();this.$4=!1}.bind(this),"MJewelThreads")};e.exports=a}),null);
__d("MRequestsJewelFriendConfirmedNotif",["CSS","DOM","MRequest","MURI","Stratcom","cx"],(function(a,b,c,d,e,f,g,h,i,j,k,l){__p&&__p();a={_viewerID:null,_unseenNotifIDs:[],_notifMarkReadListener:null,_notifToggleListener:null,_slaves:null,_master:null,_slaveShown:!1,_unread:!1,_notifStatusSet:!1,updateUnseenNotifIDs:function(a,b,c){this._viewerID=b,this._unread=c,this._unseenNotifIDs=a,this._shown=!1,this._notifStatusSet=!1,this._notifMarkReadListener===null&&(this._notifMarkReadListener=k.listen("m_requests_jewel_mark_read",null,this.setNotifsRead.bind(this))),this._notifToggleListener===null&&(this._master===null&&(this._master=h.scry(document.body,"div","m_requests_jewel_accept_notif_master")[0]),this._slaves===null&&(this._slaves=h.scry(document.body,"div","m_requests_jewel_accept_notif_slave")[0]),this._notifToggleListener=k.listen("click","m_requests_jewel_accept_notif_master",function(){this._unread&&(g.removeClass(this._master,"_uss"),this._unread=!1),this._notifStatusSet||(this.setNotifsRead,this._notifStatusSet=!0),this._slaveShown&&this._slaves!==undefined?(g.hide(this._slaves),this._slaveShown=!1):(g.show(this._slaves),this._slaveShown=!0)}.bind(this)))},setNotifsRead:function(){if(this._notifStatusSet||this._unseenNotifIDs.length===0)return;var a=new i(new j("/a/jewel_notifications_read.php").toString());a.addData({ids:this._unseenNotifIDs,count:this._unseenNotifIDs.length,seen:!1});a.send();this._notifStatusSet=!0}};e.exports=a}),null);
__d("MRequestsJewelTitleBadge",["CSS","DataStore","DOM","Stratcom","ge"],(function(a,b,c,d,e,f,g,h,i,j,k){__p&&__p();var l="friends-center-request-item";a={friendingListener:null,init:function(){var a=k("m-jewel-requests-title-badge");if(a){var b=parseInt(h.get(a,"count"),10);b<=0&&g.hide(a)}a=k("m-friend-center-requests-title-badge");a&&(b=parseInt(h.get(a,"count"),10),b<=0&&g.hide(a));this.friendingListener||(this.friendingListener=j.listen("m:optimistic-request-response:click",l,this.decrementBadgeCounts))},updateAfterNewReqs:function(a){var b=k("m-jewel-requests-title-badge");b&&a>0&&(h.set(b,"count",a),g.show(b),i.setContent(b,a))},decrementBadgeCounts:function(a){a=k("m-jewel-requests-title-badge");if(a){var b=parseInt(h.get(a,"count"),10);b=Math.max(b,0)-1;h.set(a,"count",b);b>0?(g.show(a),i.setContent(a,b)):g.hide(a)}a=k("m-friend-center-requests-title-badge");a&&(b=parseInt(h.get(a,"count"),10),b=Math.max(b,0)-1,h.set(a,"count",b),b>0?(g.show(a),i.setContent(a,b)):g.hide(a))}};e.exports=a}),null);
__d("MPopoverClose",["Popover"],(function(a,b,c,d,e,f,g){a=function(){g._activePopover&&g._activePopover.close()};f.main=a}),null);