if (self.CavalryLogger) { CavalryLogger.start_js(["JYQ8x"]); }

__d("IrisProtocolMessageLifetime",[],(function(a,b,c,d,e,f){e.exports={TTL_OFF:0,TTL_ON_UNKNOWN:1,TTL_30SECONDS:3e4,TTL_1MINUTE:6e4,TTL_3MINUTES:18e4,TTL_5MINUTES:3e5,TTL_10MINUTES:6e5,TTL_15MINUTES:9e5,TTL_30MINUTES:18e5,TTL_1HOUR:36e5,TTL_2HOURS:72e5,TTL_4HOURS:144e5,TTL_8HOURS:288e5,TTL_12HOURS:432e5,TTL_24HOURS:864e5}}),null);
__d("MercuryAudioType",[],(function(a,b,c,d,e,f){e.exports={AudioClip:"fb_voice_message",VoiceMessageWithTranscript:"fb_voice_message_with_transcript"}}),null);
__d("MessagingTag",[],(function(a,b,c,d,e,f){e.exports={GROUPS:"groups",UNREAD:"unread",FLAGGED:"flagged",ACTION_ARCHIVED:"action:archived",INBOX:"inbox",OTHER:"other",PENDING:"pending",MONTAGE:"montage",PAGES:"pages",PAGE_BACKGROUND:"page_background",EVENT:"event",SENT:"sent",SPAM:"spam",UPDATES:"broadcasts_inbox",BCC:"header:bcc",FILTERED_CONTENT:"filtered_content",FILTERED_CONTENT_BH:"filtered_content_bh",FILTERED_CONTENT_ACCOUNT:"filtered_content_account",FILTERED_CONTENT_QUASAR:"filtered_content_quasar",FILTERED_CONTENT_INVALID_APP:"filtered_content_invalid_app",UNAVAILABLE_ATTACHMENT:"unavailable_attachment",ARCHIVED:"archived",EMAIL:"email",VOICEMAIL:"voicemail",SPAM_SPOOFING:"spam:spoofing",SPOOF_WARNING:"MTA:spoof_warning",SMS_TAG_ROOT:"SMSShortcode:",APP_ID_ROOT:"app_id:",DOMAIN_AUTH_PASS:"MTA:dmarc:pass",DOMAIN_AUTH_FAIL:"MTA:dmarc:fail",MTA_SYSTEM_MESSAGE:"MTA:system_message",EMAIL_MESSAGE:"source:email",ONE_CLICK_MESSAGE:"page_one_click_message",MARKETPLACE:"marketplace",ROOM:"room",PAGE_FOLLOWUP:"page_followup",MESSAGE_REQUEST_AGGREGATION_UNIT:"message_request_aggregation_unit",IRIS_MAPPING:{FOLDER_INVALID:null,FOLDER_INBOX:"inbox",FOLDER_OTHER:"other",FOLDER_SPAM:"spam",FOLDER_PENDING:"pending",FOLDER_MONTAGE:"montage",FOLDER_HIDDEN:"hidden",FOLDER_DISABLED:"disabled",FOLDER_PAGE_BACKGROUND:"page_background",FOLDER_PAGE_DONE:"page_done",FOLDER_BLOCKED:"blocked"}}}),null);
__d("StickerConstants",[],(function(a,b,c,d,e,f){e.exports={MOBILE_LIKE_STICKER_PACK_ID:"227877430692340",GRAVEYARD_PACK_ID:"604597256247273",LIKE_STICKER_ID:"227878347358915",HOT_LIKE_SMALL_STICKER_ID:"369239263222822",HOT_LIKE_MEDIUM_STICKER_ID:"369239343222814",HOT_LIKE_LARGE_STICKER_ID:"369239383222810",MRU_STICKER_PACK:"599061016853145",SEARCH_PACK_ID:"680229632032514",OZ_PACK_ID:"1456625217993235",SPRITE_PADDING:"24",PayloadSource:{VIEW_ACTION:"view-action"},EMOTICON_PACK_ID:"1471127876485636",DEFAULT_FRAME_RATE:83,TRAY_SIZE:64,THREAD_SIZE:120}}),null);
__d("MercuryAttachmentSnippetType",["keyMirror"],(function(a,b,c,d,e,f,g){a=g({PHOTO:null,GIF:null,VIDEO:null,AUDIO_CLIP:null,STICKER:null,SHARE:null,ERROR:null,MIXED:null,GIFT:null,THIRDPARTYSTICKER:null,FILE:null,LIKE_STICKER:null});e.exports=a}),null);
__d("MercuryGiftSnippetRenderer",["fbt"],(function(a,b,c,d,e,f,g){"use strict";a={renderText:function(a,b){return a?g._("You sent a Valentine."):g._("{name} sent a Valentine.",[g._param("name",b)])}};e.exports=a}),null);
__d("P2PSnippetStringUtils",["P2PPaymentRequestStatus","P2PTransferStatus","fbt"],(function(a,b,c,d,e,f,g,h,i){__p&&__p();a={getRequestCanceledSnippet:function(a,b,c,d,e){if(a)return i._("Your request for {payment request amount} from {receiver's name} was cancelled.",[i._param("payment request amount",e),i._param("receiver's name",d)]);else if(b)return i._("{requester's name}'s request for {payment request amount} was cancelled.",[i._param("requester's name",c),i._param("payment request amount",e)]);else return i._("{requester's name}'s request for {payment request amount} from {receiver's name} was cancelled.",[i._param("requester's name",c),i._param("payment request amount",e),i._param("receiver's name",d)])},getRequestDeclinedSnippet:function(a,b,c,d,e){if(a)return i._("{receiver's name} declined your request for {payment request amount}.",[i._param("receiver's name",d),i._param("payment request amount",e)]);else if(b)return i._("You declined {requester's name}'s request for {payment request amount}.",[i._param("requester's name",c),i._param("payment request amount",e)]);else return i._("{receiver's name} declined {sender's name}'s request for {payment request amount}.",[i._param("receiver's name",d),i._param("sender's name",c),i._param("payment request amount",e)])},getRequestSentSnippet:function(a,b,c,d,e){if(a)return i._("You requested {amount} from {requestee name}.",[i._param("amount",e),i._param("requestee name",d)]);else if(b)return i._("{requester name} requested {amount} from you.",[i._param("requester name",c),i._param("amount",e)]);else return i._("{name} requested {amount} from {requestee name}.",[i._param("name",c),i._param("amount",e),i._param("requestee name",d)])},getRequestSnippetByStatus:function(a,b,c,d,e,f){a=a||g.INITED;b=[b,c,d,e,f];switch(a){case g.DECLINED:return this.getRequestDeclinedSnippet.apply(this,b);case g.TRANSFER_FAILED:case g.CANCELED:return this.getRequestCanceledSnippet.apply(this,b)}return this.getRequestSentSnippet.apply(this,b)},getTransferCanceledSnippet:function(a,b,c,d,e){if(a)return i._("Your payment of {amount} to {receiver_name} was cancelled.",[i._param("amount",e),i._param("receiver_name",d)]);else if(b)return i._("{sender name}'s payment of {amount} was cancelled.",[i._param("sender name",c),i._param("amount",e)]);else return i._("{sender_name}'s payment of {amount} to {receiver_name} was cancelled.",[i._param("sender_name",c),i._param("amount",e),i._param("receiver_name",d)])},getTransferDeclinedSnippet:function(a,b,c,d,e){if(a)return i._("{receiver_name} didn't accept your payment of {amount}.",[i._param("receiver_name",d),i._param("amount",e)]);else if(b)return i._("You didn't accept {sender name}'s payment of {amount}.",[i._param("sender name",c),i._param("amount",e)]);else return i._("{receiver_name} didn't accept {sender_name}'s payment of {amount}.",[i._param("receiver_name",d),i._param("sender_name",c),i._param("amount",e)])},getTransferSentSnippet:function(a,b,c,d,e){if(a)return i._("You sent {amount} to {receiver name}.",[i._param("receiver name",d),i._param("amount",e)]);else if(b)return i._("{name} sent {amount} to you.",[i._param("name",c),i._param("amount",e)]);else return i._("{sender name} sent {amount} to {receiver name}.",[i._param("sender name",c),i._param("receiver name",d),i._param("amount",e)])},getTransferSnippetByStatus:function(a,b,c,d,e,f){b=[b,c,d,e,f];c=a||h.PENDING_SENDER_INITED;switch(c){case h.CANCELED_DECLINED:return this.getTransferDeclinedSnippet.apply(this,b);case h.CANCELED_SENDER_RISK:case h.CANCELED_RECIPIENT_RISK:case h.CANCELED_SYSTEM_FAIL:case h.CANCELED_EXPIRED:case h.CANCELED_SAME_CARD:return this.getTransferCanceledSnippet.apply(this,b)}return this.getTransferSentSnippet.apply(this,b)}};e.exports=a}),null);
__d("MercuryAttachmentSnippetRenderer",["CurrentUser","MercuryAttachmentSnippetType","MercuryAttachmentType","MercuryAudioType","MercuryGiftSnippetRenderer","MessengerLightweightActionUtils","P2PSnippetStringUtils","StickerConstants","StoryAttachmentStyle","fbt","gkx"],(function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){"use strict";__p&&__p();a={getAttachmentSnippetType:function(a){__p&&__p();if(this._hasOnlyPhotos(a))return h.PHOTO;if(this._hasOnlyAnimatedImages(a))return h.GIF;if(this._hasOnlyVideo(a))return h.VIDEO;if(this._hasAudioClip(a))return h.AUDIO_CLIP;if(this._hasLikeSticker(a))return h.LIKE_STICKER;if(this._hasSticker(a))return h.STICKER;if(this._hasThirdPartySticker(a))return h.THIRDPARTYSTICKER;if(this._hasShare(a))return h.SHARE;if(this._hasGift(a))return h.GIFT;if(this._hasError(a))return h.ERROR;return this._hasFile(a)?h.FILE:h.MIXED},renderAttachmentSnippetText:function(a,b,c,d){__p&&__p();switch(a){case h.PHOTO:return this._renderPhotoAttachmentSnippetText(b,c,this._getPhotoAttachments(d));case h.GIF:return this._renderAnimatedImagesAttachmentSnippetText(b,c,this._getAnimatedImageAttachments(d));case h.VIDEO:return b?p._("You sent a video."):p._("{sender name} sent a video.",[p._param("sender name",c)]);case h.AUDIO_CLIP:return b?p._("You sent a voice message."):p._("{name} sent a voice message.",[p._param("name",c)]);case h.STICKER:case h.LIKE_STICKER:case h.THIRDPARTYSTICKER:return b?p._("You sent a sticker."):p._("{name} sent a sticker.",[p._param("name",c)]);case h.SHARE:if(d&&this._hasP2PPayment(d))return this._renderP2PPaymentSnippetText(d[0]);if(d&&this._hasP2PPaymentRequest(d))return this._renderP2PPaymentRequestSnippetText(d[0]);if(d&&this._hasBusinessMessage(d))return this._renderBusinessMessageSnippetText(d[0],c);if(d&&this._hasLocation(d))return b?p._("You sent a location."):p._("{sender name} sent a location.",[p._param("sender name",c)]);if(d&&this._hasLiveLocation(d))return b?p._("You sent a live location."):p._("{sender name} sent a live location.",[p._param("sender name",c)]);if(d&&this._hasMontageDirect(d)){if(!q("AT5MAotH6BG7mXo4DyZnW3seA7_jf32c8tGX1llmkbXJ5ui_oKs0jpz-iYum9Gkv1o7pv5ZMvW9WlaNx_vA1ZSmAhi0Rjb62jJA5vu2Oz81AxQ"))return b?p._("You sent a link."):p._("{sender name} sent a link.",[p._param("sender name",c)]);a=d[0];a=(a=a)!=null?(a=a.share)!=null?(a=a.media)!=null?a.source:a:a:a;return b?a?p._("You sent a video."):p._("You sent a photo."):a?p._("View {sender name}'s disappearing video.",[p._param("sender name",c)]):p._("View {sender name}'s disappearing photo.",[p._param("sender name",c)])}return d&&d.length===1&&l.isLWAAttachment(d[0])?l.getLWASnippetText(d):b?p._("You sent a link."):p._("{sender name} sent a link.",[p._param("sender name",c)]);case h.GIFT:return k.renderText(b,c);case h.FILE:return b?p._("You sent an attachment."):p._("{sender name} sent an attachment.",[p._param("sender name",c)]);case h.ERROR:return b?p._("You sent an attachment."):p._("{sender name} sent an attachment.",[p._param("sender name",c)]);default:return""}},_hasOnlyPhotos:function(a){return this._getPhotoAttachments(a).length===a.length},_hasThirdPartySticker:function(a){return a.length===1&&a[0].attach_type===i.THIRDPARTYSTICKER},_hasOnlyAnimatedImages:function(a){return this._getAnimatedImageAttachments(a).length===a.length},_hasOnlyVideo:function(a){return a.length===1&&a[0].attach_type===i.VIDEO},_hasAudioClip:function(a){var b=a[0].metadata&&a[0].metadata.type;return a.length===1&&(b===j.AudioClip||b===j.VoiceMessageWithTranscript)},_hasBusinessMessage:function(a){return this._hasSingleShareAttachmentOfStyle(a,o.BUSINESS_MESSAGE_ITEMS)},_hasSticker:function(a){return a.length===1&&a[0].attach_type===i.STICKER},_hasLikeSticker:function(a){if(a.length<1)return!1;var b=a[0].metadata&&a[0].metadata.stickerID;return a.length===1&&(b==n.LIKE_STICKER_ID||b==n.HOT_LIKE_SMALL_STICKER_ID||b==n.HOT_LIKE_MEDIUM_STICKER_ID||b==n.HOT_LIKE_LARGE_STICKER_ID)},_hasLocation:function(a){return this._hasSingleShareAttachmentOfStyle(a,o.MESSAGE_LOCATION)},_hasLiveLocation:function(a){return this._hasSingleShareAttachmentOfStyle(a,o.MESSAGE_LIVE_LOCATION)},_hasMontageDirect:function(a){return this._hasSingleShareAttachmentOfStyle(a,o.MONTAGE_DIRECT)},_hasP2PPayment:function(a){return this._hasSingleShareAttachmentOfStyle(a,o.ORION)},_hasP2PPaymentRequest:function(a){return this._hasSingleShareAttachmentOfStyle(a,o.ORION_REQUEST)},_hasSingleShareAttachmentOfStyle:function(a,b){return a.length===1&&a[0].attach_type===i.SHARE&&a[0].share.style_list.indexOf(b)>=0},_hasShare:function(a){return a.length===1&&a[0].attach_type===i.SHARE},_hasError:function(a){return a.length===1&&a[0].attach_type===i.ERROR},_hasGift:function(a){return a.length===1&&a[0].attach_type===i.GIFT},_hasFile:function(a){return a.length===1&&a[0].attach_type===i.FILE},_getPhotoAttachments:function(a){return!a?[]:a.filter(function(a){return a.attach_type===i.PHOTO})},_getAnimatedImageAttachments:function(a){return!a?[]:a.filter(function(a){return a.attach_type===i.ANIMATED_IMAGE})},_renderPhotoAttachmentSnippetText:function(a,b,c){if(c.length===1)if(a)return p._("You sent a photo.");else return p._("{name} sent a photo.",[p._param("name",b)]);else if(a)return p._({"*":"You sent {num_photos} photos."},[p._param("num_photos",c.length,[0])]);else return p._({"*":"{name} sent {num_photos} photos."},[p._param("name",b),p._param("num_photos",c.length,[0])])},_renderAnimatedImagesAttachmentSnippetText:function(a,b,c){if(c.length===1)if(a)return p._("You sent a GIF.");else return p._("{name} sent a GIF.",[p._param("name",b)]);else if(a)return p._("You sent {num_animated_images} GIFs.",[p._param("num_animated_images",c.length)]);else return p._("{name} sent {num_animated_images} GIFs.",[p._param("name",b),p._param("num_animated_images",c.length)])},_renderBusinessMessageSnippetText:function(a,b){a=a.share.target;a=a&&a.message||p._("{sender name} sent an attachment.",[p._param("sender name",b)]);return a},_renderP2PPaymentSnippetText:function(a){a=a.share.target;return this.renderP2PPaymentSnippetText(g.getID()===a.sender.id,a.sender.name,a.amountWithSymbol,a.status,g.getID()===a.receiver.id,a.receiver.name)},_renderP2PPaymentRequestSnippetText:function(a){a=a.share.target;return this.renderP2PPaymentRequestSnippetText(g.getID()===a.requester.id,a.requester.name,a.amountWithSymbol,a.currentStatus,g.getID()===a.requestee.id,a.requestee.name)},renderP2PPaymentSnippetText:function(a,b,c,d,e,f){return m.getTransferSnippetByStatus(d,a,e||!1,b||"",f||"",c)},renderP2PPaymentRequestSnippetText:function(a,b,c,d,e,f){return m.getRequestSnippetByStatus(d,a,e||!1,b||"",f||"",c)}};e.exports=a}),null);
__d("MMessagePayload",["ChannelEventType","CurrentUser","MercuryAttachmentSnippetRenderer","MercuryAttachmentType","MercuryAudioType","P2PPaymentRequestStatus","P2PTransferStatus","StoryAttachmentStyle","fbt","formatDate"],(function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){"use strict";__p&&__p();var q=25,r=1e3,s="g:ia";function a(a){this.$1=a}a.prototype.isPageMessage=function(){return this.$1.type===g.PAGES_MESSAGE};a.prototype.getThreadFBID=function(){return this.$1.thread_fbid&&this.$1.thread_fbid.toString()};a.prototype.getHref=function(){return this.$1.href};a.prototype.getAuthorFBID=function(){return this.$1.sender_fbid.toString()};a.prototype.getAuthorName=function(){return this.$1.sender_name};a.prototype.getThreadName=function(){return this.$1.thread_name};a.prototype.getThreadUnreadCount=function(){return this.$1.thread_unread_count};a.prototype.getSnippet=function(){__p&&__p();var a=this.$1.body;if(a)if(a.length>q)return o._("{shortened body}{dot dot dot (for truncation)}",[o._param("shortened body",a.substring(0,q)),o._param("dot dot dot (for truncation)","...")]);else return a;a=this.$1.attachments.map(function(a){__p&&__p();if(a.sticker_attachment)return{attach_type:j.STICKER,metadata:{stickerID:a.sticker_attachment.id}};else if(a.blob_attachment)if(a.blob_attachment.__typename==="MessageImage")if(a.blob_attachment.render_as_sticker)return{attach_type:j.THIRDPARTYSTICKER};else return{attach_type:j.PHOTO};else if(a.blob_attachment.__typename==="MessageAnimatedImage")return{attach_type:j.ANIMATED_IMAGE};else if(a.blob_attachment.__typename==="MessageVideo")return{attach_type:j.VIDEO};else if(a.blob_attachment.audio_type&&(a.blob_attachment.audio_type==="VOICE_MESSAGE"||a.blob_attachment.audio_type==="VOICE_MESSAGE_WITH_TRANSCRIPT"))return{metadata:{type:k.AudioClip}};else if(a.blob_attachment.__typename==="MessageFile")if(a.blob_attachment.is_malicious)return{attach_type:j.ERROR};else return{attach_type:j.FILE};else return{attach_type:j.UNKNOWN};else if(a.extensible_attachment)if(a.extensible_attachment.story_attachment){var b;a=a.extensible_attachment.story_attachment;var c=a.target;b=(b=c)!=null?b.__typename:b;if(b==="MessengerBusinessMessage"){return{share:{style_list:a.style_list,target:{message:(a=c)!=null?a.message:a}},attach_type:j.SHARE}}else if(b==="PeerToPeerPaymentRequest"){var d;a=(a=c)!=null?a.request_status:a;return{share:{style_list:[n.ORION_REQUEST],target:{requester:{id:(d=c)!=null?(d=d.requester)!=null?d.id:d:d,name:(d=c)!=null?(d=d.requester)!=null?d.short_name:d:d},amountWithSymbol:(d=c)!=null?(d=d.amount)!=null?d.formatted:d:d,currentStatus:a?l[a]:null,requestee:{id:(d=c)!=null?(d=d.requestee)!=null?d.id:d:d,name:(a=c)!=null?(a=a.requestee)!=null?a.short_name:a:a}}},attach_type:j.SHARE}}else if(b==="PeerToPeerTransfer"){a=(d=c)!=null?d.transfer_status:d;return{share:{style_list:[n.ORION],target:{sender:(d=c)!=null?d.sender:d,amountWithSymbol:(d=c)!=null?(d=d.transaction_amount)!=null?d.formatted_amount:d:d,status:a?m[a]:null,receiver:{id:(d=c)!=null?(d=d.receiver_profile)!=null?d.id:d:d,name:(a=c)!=null?(a=a.receiver_profile)!=null?a.short_name:a:a}}},attach_type:j.SHARE}}else if(b==="MessageLiveLocation")return{share:{style_list:[n.MESSAGE_LIVE_LOCATION]},attach_type:j.SHARE};else if(b==="MessageLocation")return{share:{style_list:[n.MESSAGE_LOCATION]},attach_type:j.SHARE};return{attach_type:j.SHARE}}else return{attach_type:j.SHARE};else return{attach_type:j.UNKNOWN}});var b=i.getAttachmentSnippetType(a);return i.renderAttachmentSnippetText(b,this.getAuthorFBID()===h.getID(),this.getAuthorName(),a)};a.prototype.getMessage=function(){return this.$1.body};a.prototype.getTime=function(){return p(this.$1.timestamp/r,s)};a.prototype.getTimestamp=function(){return this.$1.timestamp.toString()};a.prototype.getUUID=function(){return this.$1.message_id};a.prototype.getFolder=function(){return this.$1.folder};a.prototype.getMessageSource=function(){return this.$1.source};a.prototype.getParticipantIDs=function(){var a=this.$1.participant_ids||[];return a.map(function(a){return a.toString()})};a.prototype.hasThreadImage=function(){return this.$1.has_thread_image};a.prototype.getAttachmentCount=function(){return this.$1.attachments.length};a.prototype.getAttachments=function(){return this.$1.attachments};a.prototype.isCanonicalThread=function(){return!!this.$1.is_canonical};a.prototype.isUnread=function(){return this.$1.is_unread};a.prototype.getOtherUserFBID=function(){var a=this.$1.participant_ids;if(!this.isCanonicalThread())return null;else if(a.length===1)return a[0].toString();else return a[0].toString()===h.getID()?this.isPageMessage()?a[0].toString():a[1].toString():a[0].toString()};a.prototype.getThreadNameWithUnreadCount=function(){return!this.getThreadUnreadCount()?this.getThreadName():o._("{thread name} ({unread count})",[o._param("thread name",this.getThreadName()),o._param("unread count",this.getThreadUnreadCount())])};e.exports=a}),null);
__d("MMessagesChannelPayloadPreparer",["Promise","MercuryIDs","MMessagePayload","MMessagesConfig","MMessagesThreadDataStore","MShortProfiles","StoryAttachmentStyle","Stratcom","promiseDone"],(function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){"use strict";__p&&__p();a={fetchDataThenDispatch:function(a){__p&&__p();a.message.folder=a.folder;a.message.sender_fbid=h.getUserIDFromParticipantID(a.message.author);j.msite_genie_xma_rendering&&this._processGenieMessage(a.message);var b=a.targetFBID?a.targetFBID:a.realtime_viewer_fbid.toString(),c=[new g(function(c,d){d=k.getForFBID(b);d.getForNewMessage(a.message.other_user_fbid,a.message.thread_fbid,a.message.message_id,a.message.is_unread,function(a){c(a)})}),new g(function(b,c){l.get(a.message.sender_fbid.toString(),function(a){b(a)})})];o(g.all(c),function(b){var c=b[0];b=b[1];Object.assign(a.message,{is_muted:c.mute_until!==undefined,thread_name:c.thread_name,participant_ids:c.participant_ids,has_thread_image:c.has_thread_image,is_canonical:c.is_canonical,href:c.href,thread_unread_count:c.thread_unread_count,pages_is_flagged:c.pages_is_flagged,sender_name:b.name,type:a.type});a.parsedPayload=new i(a.message);n.invoke(a.type,null,a)})},_processGenieMessage:function(a){__p&&__p();if(!a.has_attachment||!a.attachments)return;for(var b=a.attachments.length-1;b>=0;b-=1){var c=a.attachments[b];if(!c.share||!c.share.style_list||c.share.style_list[0]!=m.GENIE_MESSAGE)continue;c.share.target.genie_id&&(a.sender_fbid=c.share.target.genie_id,a.sender="fbid:"+c.share.target.genie_id);c.share.target.genie_name&&(a.sender_name=c.share.target.genie_name);c.share.target&&!c.share.target.attachment&&(a.attachments.splice(b,1),a.has_attachment=a.attachments.length>0)}}};e.exports=a}),null);
__d("MercuryMessageCustomizations",[],(function(a,b,c,d,e,f){"use strict";function a(a){var b=JSON.parse(a),c=[];Object.keys(b).forEach(function(a){c.push({customization_type:a,customization_value:b[a]})});return c}e.exports={parseCustomizations:a}}),null);
__d("MercuryProfileRanges",[],(function(a,b,c,d,e,f){"use strict";__p&&__p();function g(a){return!a.id&&a.i?{id:a.i,offset:a.o,length:a.l}:a}e.exports={extractFromDelta:function(a){a=(a=a)!=null?(a=a.data)!=null?a.prng:a:a;if(!a)return undefined;var b=[];try{b=JSON.parse(a);if(b.length>0)return b.map(g)}catch(a){}return b}}}),null);
__d("MercurySyncDeltaTypes",[],(function(a,b,c,d,e,f){"use strict";a={AdminAddedToGroupThread:"AdminAddedToGroupThread",AdminRemovedFromGroupThread:"AdminRemovedFromGroupThread",AdminTextMessage:"AdminTextMessage",ChangeViewerStatus:"ChangeViewerStatus",DeliveryReceipt:"DeliveryReceipt",ForcedFetch:"ForcedFetch",MarkRead:"MarkRead",MarkUnread:"MarkUnread",MarkFolderSeen:"MarkFolderSeen",MessageDelete:"MessageDelete",NewMessage:"NewMessage",NoOp:"NoOp",PagesManagerEvent:"PagesManagerEvent",ParticipantLeftGroupThread:"ParticipantLeftGroupThread",ParticipantsAddedToGroupThread:"ParticipantsAddedToGroupThread",ReadReceipt:"ReadReceipt",ReplaceMessage:"ReplaceMessage",RTCEventLog:"RTCEventLog",ThreadAction:"ThreadAction",ThreadDelete:"ThreadDelete",ThreadFolder:"ThreadFolder",ThreadMuteSettings:"ThreadMuteSettings",ThreadName:"ThreadName",JoinableMode:"JoinableMode",ApprovalMode:"ApprovalMode",ApprovalQueue:"ApprovalQueue",ClientPayload:"ClientPayload",GenieMessage:"GenieMessage",MontageMessage:"MontageMessage",RtcCallData:"RtcCallData"};e.exports=a}),null);
__d("MercurySyncMarkFolderSeenTransformer",["MercuryGlobalActionType","MessagingTag"],(function(a,b,c,d,e,f,g,h){"use strict";function a(a){return a.folders.map(function(b){return{action_type:g.MARK_ALL_SEEN,folder:h.IRIS_MAPPING[b],timestamp:parseInt(a.timestamp,10)}})}e.exports={transform:a}}),null);
__d("MercurySyncMarkReadTransformer",["MercuryActionType","MercuryGlobalActionType","MessagingTag"],(function(a,b,c,d,e,f,g,h,i){"use strict";function a(a){return a.folders&&a.folders.length>0?a.folders.map(function(b){return{action_type:h.MARK_ALL_READ,action_id:null,folder:i.IRIS_MAPPING[b],timestamp:parseInt(a.watermarkTimestamp,10)}}):a.threadKeys.map(function(b){return{action_type:g.CHANGE_READ_STATUS,other_user_fbid:b.otherUserFbId,thread_fbid:b.threadFbId,mark_as_read:!0,timestamp:parseInt(a.watermarkTimestamp,10),folder:i.INBOX}})}e.exports={transform:a}}),null);
__d("MercurySyncMarkUnreadTransformer",["MercuryActionType","MessagingTag"],(function(a,b,c,d,e,f,g,h){"use strict";function a(a){return a.threadKeys.map(function(b){return{action_type:g.CHANGE_READ_STATUS,other_user_fbid:b.otherUserFbId,thread_fbid:b.threadFbId,mark_as_read:!1,timestamp:parseInt(a.watermarkTimestamp,10),folder:h.INBOX}})}e.exports={transform:a}}),null);
__d("MercurySyncPagesManagerEventTransformer",["MercuryActionType","PagesMessagingEventType"],(function(a,b,c,d,e,f,g,h){"use strict";__p&&__p();function a(a){var b=JSON.parse(a.jsonBlob),c=b&&b.type;if(!c)return undefined;switch(c){case h.FLAG:c=!!(b&&b.flagData&&b.flagData.state);b={action_type:g.CHANGE_FLAG,mark_as_flag:c,other_user_fbid:a.threadKey.otherUserFbId,thread_fbid:a.threadKey.threadFbId};return b;default:return undefined}}e.exports={transform:a}}),null);
__d("MercurySyncReadReceiptTransformer",[],(function(a,b,c,d,e,f){"use strict";function a(a){var b={watermark:parseInt(a.watermarkTimestampMs,10),action:parseInt(a.actionTimestampMs,10)},c=a.threadKey.otherUserFbId||a.actorFbId;a=a.threadKey.otherUserFbId||a.threadKey.threadFbId;var d={roger:{}};d.roger[a]={};d.roger[a][c]=b;return d}e.exports={transform:a}}),null);
__d("MMercurySyncDispatcher",["ChannelEventType","CurrentUser","MercuryActionType","MercuryGlobalActionType","MercurySingletonProvider","MercurySyncDeltaTypes","MercurySyncMarkFolderSeenTransformer","MercurySyncMarkReadTransformer","MercurySyncMarkUnreadTransformer","MercurySyncPagesManagerEventTransformer","MercurySyncReadReceiptTransformer","MessagingEvent","MessagingTag","MMercurySyncNewMessageTransformer","MMercurySyncReplaceMessageTransformer","MMessagesChannelPayloadPreparer","MMessagesReadReceipts","MMessagesThreadDataStore","MReplaceMessageProcessor","Stratcom","emptyFunction"],(function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A){"use strict";__p&&__p();a.getForFBID=function(a){return B.getForFBID(a)};a.get=function(){return B.get()};function a(a){this.$1=a,this.$2=h.getAccountID()===this.$1?g.MESSAGE:g.PAGES_MESSAGE}a.prototype.process=function(a){__p&&__p();var b,c;switch(a["class"]){case l.NewMessage:b=t.transform(this.$1,a);c={message:b,type:this.$2,folder:s.INBOX,targetFBID:this.$1};v.fetchDataThenDispatch(c);break;case l.MarkUnread:b=o.transform(a);b.map(function(a){c={message:a,type:this.$2,event:r.UNREAD,is_sync:!0,targetFBID:this.$1},z.invoke(c.type,null,c)}.bind(this));break;case l.MarkRead:b=n.transform(a);b.map(function(a){a.action_type===j.MARK_ALL_READ?x.getForFBID(this.$1).clearAllUnread():x.getForFBID(this.$1).clearUnreadCount(a.other_user_fbid,a.thread_fbid,A),c={message:a,type:this.$2,event:a.action_type===j.MARK_ALL_READ?r.MARK_ALL_READ:r.READ,is_sync:!0,targetFBID:this.$1},z.invoke(c.type,null,c)}.bind(this));break;case l.MarkFolderSeen:b=m.transform(a);b.map(function(a){c={message:a,type:this.$2,event:r.MARK_ALL_SEEN,is_sync:!0,targetFBID:this.$1},z.invoke(c.type,null,c)}.bind(this));break;case l.ReadReceipt:b=q.transform(a);var d=Object.keys(b.roger)[0],e=b.roger[d];w.update(d,e);c={message:b,type:this.$2,event:r.READ_RECEIPT,is_sync:!0,targetFBID:this.$1};z.invoke(c.type,null,c);break;case l.PagesManagerEvent:b=p.transform(a);if(!b||b.action_type!==i.CHANGE_FLAG)return;x.getForFBID(this.$1).updateFlagStatus(b.other_user_fbid,null,b.mark_as_flag,A);c={event:g.PAGE_THREAD_FLAG_CHANGED,flagged:b.mark_as_flag,other_user_fbid:b.other_user_fbid,type:g.PAGES_MESSAGE};z.invoke(c.type,null,c);break;case l.ReplaceMessage:b=u.transform(this.$1,a);c={message:b,type:this.$2,folder:s.INBOX,targetFBID:this.$1};y.process(c);break;case l.ClientPayload:d=JSON.parse(String.fromCharCode.apply(null,a.payload));e=d&&d.deltas;if(e.length>0){a=e[0];if(a.deltaMessageReply){d=a.deltaMessageReply.message;b=t.transform(this.$1,d);c={message:b,type:this.$2,folder:s.INBOX,targetFBID:this.$1};v.fetchDataThenDispatch(c)}}break;default:break}};var B=new k(a);e.exports=a}),null);
__d("MTouchChannelPayloadRouter",["ChannelEventType","MessagingEvent","MMercurySyncDispatcher","Stratcom"],(function(a,b,c,d,e,f,g,h,i,j){"use strict";__p&&__p();function a(a){if(k(a)||m(a)||n(a))return;else if(l(a)){var b=a.queue.toString();i.getForFBID(b).process(a.delta)}else j.invoke(a.type,null,a)}function k(a){return(a.type===g.MESSAGE||a.type===g.PAGES_MESSAGE)&&a.message}function l(a){return a.type===g.DELTA}function m(a){return(a.type===g.MESSAGE||a.type===g.PAGES_MESSAGE)&&a.event===h.READ}function n(a){return a.type===g.PAGES_MESSAGE&&a.event===g.PAGE_THREAD_FLAG_CHANGED}f.route=a}),null);
__d("MercuryTimestamp",["MercuryTimePassed","fbt","formatDate"],(function(a,b,c,d,e,f,g,h,i){__p&&__p();a=864e5;var j=6*a,k={getFormatedTimestamp:function(a){var b=a/1e3;return k.getFormattedTimestampByBucket(b,this.getTimeBucket(a))},getAbsoluteTimestamp:function(a){if(a==null)return null;else{a=k.getFormatedTimestamp(a);return a.absolute}},getRelativeTimestamp:function(a){a=k.getFormatedTimestamp(a);return a.relative},getFormattedTimestampByBucket:function(a,b){switch(b){case g.TODAY:return{absolute:h._("Today"),relative:i(a,"g:ia")};case g.WEEK_AGO:return{absolute:i(a,"l"),relative:i(a,"D")};case g.CURRENT_YEAR:return{absolute:i(a,"F j"),relative:i(a,"M j")};default:return{absolute:i(a,"F j, Y"),relative:i(a,"n/j/y")}}},getTimeBucket:function(a){__p&&__p();a=new Date(a);var b=new Date();b=new Date(b.getFullYear(),b.getMonth(),b.getDate());if(b<a)return g.TODAY;else if(b-j<a)return g.WEEK_AGO;else if(b.getFullYear()===a.getFullYear())return g.CURRENT_YEAR;else return g.OTHER_YEAR},getPreciseTimestamp:function(a){return i(new Date(a),k.getPreciseFormat(a))},getPreciseFormat:function(a){a=k.getTimeBucket(a);switch(a){case g.TODAY:return"g:ia";case g.WEEK_AGO:return"l g:ia";case g.CURRENT_YEAR:return"F jS, g:ia";case g.OTHER_YEAR:default:return"F j, Y g:i a"}}};e.exports=k}),null);